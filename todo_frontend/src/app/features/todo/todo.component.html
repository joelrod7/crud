<div class="wrap">
  <div class="bar">
    <h2>Tareas</h2>
    <button class="btn danger" (click)="logout()">Salir</button>
  </div>

  <div *ngIf="errorMsg()" class="alert error">{{ errorMsg() }}</div>

  <!-- Formulario creación -->
  <form [formGroup]="form" (ngSubmit)="save()" class="card form">
    <div class="grid">
      <label>
        Título
        <input type="text" formControlName="titulo" maxlength="20" />
      </label>

      <label class="wide">
        Descripción
        <input type="text" formControlName="descripcion" maxlength="100" />
      </label>

      <label>
        Inicio
        <input type="datetime-local" formControlName="fecha_inicio" />
      </label>

      <label>
        Fin
        <input type="datetime-local" formControlName="fecha_fin" />
      </label>

      <label>
        Estado (int)
        <input type="number" formControlName="estado" />
      </label>
    </div>

    <button class="btn primary" type="submit" [disabled]="loadingCreate() || form.invalid">
      {{ loadingCreate() ? 'Guardando...' : 'Guardar' }}
    </button>
  </form>

  <!-- Tabla -->
  <div class="card">
    <div class="table-wrap" [class.loading]="loadingList()">
      <table>
        <thead>
          <tr>
            <th>Título</th>
            <th>Descripción</th>
            <th>Creación</th>
            <th>Inicio</th>
            <th>Fin</th>
            <th>Estado</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let t of tasks(); trackBy: trackById">
            <td>{{ t.titulo }}</td>
            <td>{{ t.descripcion }}</td>
            <td>{{ t.fecha_creacion | date:'short' }}</td>
            <td>{{ t.fecha_inicio    | date:'short' }}</td>
            <td>{{ t.fecha_fin       | date:'short' }}</td>
            <td>{{ t.estado }}</td>
          </tr>

          <tr *ngIf="!loadingList() && tasks().length === 0">
            <td colspan="6" class="empty">Sin tareas aún</td>
          </tr>
        </tbody>
      </table>
      <div class="spinner" *ngIf="loadingList()">Cargando...</div>
    </div>
  </div>
</div>
